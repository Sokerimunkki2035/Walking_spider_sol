<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solitaire - Spider/Scorpion/Golf</title>
  
  <!-- 
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  KOHTA 1: GOOGLE ADSENSE - Vaihda tÃ¤hÃ¤n omat tunnuksesi   â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
  
  <style>
    :root{
      --cardW: 50px;
      --cardH: 68px;
      --gap: 4px;
      --stack-offset: 16px;    /* Avoinkorttien vÃ¤li */
      --hidden-offset: 3px;    /* Piilokorttien vÃ¤li */
      --bg: #0d4a3a;
    }
    
    *{box-sizing:border-box; margin:0; padding:0}
    body{
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(180deg, var(--bg), #062921);
      color: #e8f5f2;
      min-height: 100vh;
      padding: 10px;
    }
    
    /* 
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  KOHTA 2: MAINOSTEN KOOT - Muuta tarvittaessa            â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    .ad-box{
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      margin: 8px 0;
      min-height: 90px;  /* Vaihda: 90px, 250px, 100px */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      opacity: 0.6;
    }
    
    .topbar{
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.2);
      padding: 10px 15px;
      border-radius: 25px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .nav{
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    
    .btn{
      padding: 10px 16px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: inherit;
      cursor: pointer;
      font-weight: 600;
    }
    
    .btn.active{
      background: rgba(100,255,150,0.2);
      border-color: rgba(100,255,150,0.4);
    }
    
    .btn:disabled{
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .panel{
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 10px;
    }
    
    /* 
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  KOHTA 3: PÃ–YDÃ„N GRID - Sarakkeiden mÃ¤Ã¤rÃ¤ peleittÃ¤in      â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    .table{
      display: grid;
      gap: var(--gap);
      margin-top: 10px;
    }
    
    /* Spider = 10 saraketta */
    .table.spider{ grid-template-columns: repeat(10, 1fr); }
    
    /* Scorpion & Golf = 7 saraketta */
    .table.scorpion{ grid-template-columns: repeat(7, 1fr); }
    .table.golf{ grid-template-columns: repeat(7, 1fr); }
    
    /* Mobiili: vÃ¤hemmÃ¤n sarakkeita */
    @media (max-width: 600px){
      .table.spider{ grid-template-columns: repeat(5, 1fr); }
      .table.scorpion, .table.golf{ grid-template-columns: repeat(4, 1fr); }
    }
    
    .col{
      background: rgba(0,0,0,0.15);
      border-radius: 10px;
      padding: 5px;
      min-height: 200px;
      position: relative;
    }
    
    .col-header{
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 5px;
      opacity: 0.8;
    }
    
    /* 
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  KOHTA 4: KORTTIEN ULKOASU - Muuta vÃ¤rejÃ¤/kokoja          â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */
    .card{
      position: absolute;
      width: var(--cardW);
      height: var(--cardH);
      left: 50%;
      transform: translateX(-50%);
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 4px;
      font-size: 14px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      cursor: pointer;
      user-select: none;
      border: 1px solid rgba(0,0,0,0.1);
    }
    
    /* Avoin kortti */
    .card.up{
      background: #f0f4f3;
      color: #1a1a1a;
    }
    
    /* Piilokortti */
    .card.down{
      background: linear-gradient(135deg, #1e6b5a, #0d3d32);
      color: transparent;
    }
    
    /* Valittu kortti */
    .card.selected{
      outline: 3px solid #ffd700;
      box-shadow: 0 0 15px rgba(255,215,0,0.5);
      z-index: 100;
    }
    
    /* MaavÃ¤rit */
    .suit-red{ color: #c41e3a; }
    .suit-black{ color: #1a1a1a; }
    
    /* Pinon alapuolella nÃ¤kyvÃ¤ iso numero */
    .col-footer{
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: 900;
      opacity: 0.3;
      pointer-events: none;
    }
    
    .controls{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 10px 0;
    }
    
    #toast{
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      padding: 12px 20px;
      border-radius: 25px;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

<!-- KOHTA 5: YLÃ„MAINOS -->
<div class="ad-box">
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="YYYYYYYYYY"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<div class="topbar">
  <div>ğŸƒ Solitaire</div>
  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <span>ğŸ”¥ <b id="streak">0</b></span>
    <span>ğŸ¯ <b id="goal">3</b>min</span>
    <span>âœ… <b id="done">0</b>min</span>
  </div>
</div>

<div class="nav">
  <button class="btn active" onclick="setTab('walk')">ğŸƒ KÃ¤vely</button>
  <button class="btn" onclick="setTab('spider')">ğŸ•·ï¸ Spider</button>
  <button class="btn" onclick="setTab('scorpion')">ğŸ¦‚ Scorpion</button>
  <button class="btn" onclick="setTab('golf')">â›³ Golf</button>
</div>

<!-- KÃ„VELYPANEELI -->
<div id="walkPanel" class="panel">
  <h2>PÃ¤ivÃ¤n kÃ¤vely</h2>
  <p style="margin:10px 0;">Valitse tavoite ja aloita. Pelit aukeavat kun tavoite tÃ¤yttyy.</p>
  <div class="controls">
    <button class="btn" onclick="setGoal(3)">3 min</button>
    <button class="btn" onclick="setGoal(5)">5 min</button>
    <button class="btn" onclick="setGoal(7)">7 min</button>
    <button class="btn primary" onclick="startWalk()" id="walkBtn">Aloita kÃ¤vely</button>
  </div>
  <p style="margin-top:10px; font-size:13px; opacity:0.8;">
    TÃ¤nÃ¤Ã¤n: <span id="walkStatus">0/3 min</span>
  </p>
</div>

<!-- PELIPANEELI -->
<div id="gamePanel" class="panel" style="display:none;">
  <div class="controls">
    <button class="btn" onclick="newGame()">Uusi peli</button>
    <button class="btn" onclick="restartGame()">Aloita alusta</button>
    <button class="btn" onclick="undo()">â†©ï¸ Undo</button>
    <button class="btn" onclick="deal()">ğŸ“¥ Jaa kortteja</button>
  </div>
  
  <!-- KOHTA 6: PELIALUEEN MAINOS -->
  <div class="ad-box" style="min-height:100px;">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"></ins>
  </div>
  
  <div style="margin:10px 0; font-size:13px; opacity:0.9;" id="gameInfo">
    Siirrot: 0 | Valitse kortti ja kohde
  </div>
  
  <div id="table" class="table"></div>
</div>

<!-- KOHTA 7: ALAMAINOS -->
<div class="ad-box" style="min-height:250px;">
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"></ins>
</div>

<div id="toast"></div>

<script>
/* 
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  KOHTA 8: PELILOGIIKKA - TÃ¤mÃ¤ on se kriittinen osa!        â•‘
â•‘  Ã„lÃ¤ muuta ellet tiedÃ¤ mitÃ¤ teet                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

// ==================== ASETUKSET ====================
const CONFIG = {
  // KÃ¤velyn oletustavoite (minuutteja)
  defaultGoal: 3,
  
  // Voiko pelata ilman kÃ¤velyÃ¤ (true = debug, false = tuotanto)
  skipWalk: true,  // â­ MUUTA TÃ„MÃ„ FALSEksi kun kaikki toimii!
  
  // Spider: sallitaanko siirto tyhjÃ¤Ã¤n pinoon
  spiderAllowEmpty: true,
  
  // Korttien mÃ¤Ã¤rÃ¤t
  spiderDecks: 2,      // 2 pakkaa = 104 korttia
  scorpionDecks: 1,    // 1 pakka = 52 korttia
  golfRows: 5          // 5 riviÃ¤ golfissa
};

// ==================== PELITILA ====================
let state = {
  tab: 'walk',
  walk: {
    goal: 3,
    done: 0,
    running: false,
    date: new Date().toDateString()
  },
  game: null,      // spider | scorpion | golf
  data: null,      // pelin data
  selected: null,  // {col, idx, cards}
  history: [],     // undo-pino
  seed: Date.now()
};

// ==================== APUFUNKTIOT ====================
function $(id){ return document.getElementById(id); }
function toast(msg){
  const t=$('toast'); t.textContent=msg; t.style.display='block';
  setTimeout(()=>t.style.display='none', 2000);
}

function rand(seed){
  return function(){
    seed = (seed * 9301 + 49297) % 233280;
    return seed / 233280;
  };
}

function formatCard(r, s){
  const ranks = {1:'A',11:'J',12:'Q',13:'K'};
  return {r, s, rank: ranks[r]||r, suit: s, red: (s==='â™¥'||s==='â™¦')};
}

// ==================== KÃ„VELY ====================
function setGoal(m){
  state.walk.goal = m;
  $('goal').textContent = m;
  updateWalkUI();
}

function updateWalkUI(){
  const w = state.walk;
  $('done').textContent = Math.floor(w.done/60);
  $('walkStatus').textContent = `${Math.floor(w.done/60)}/${w.goal} min`;
  
  // Tarkista onko uusi pÃ¤ivÃ¤
  const today = new Date().toDateString();
  if(w.date !== today){
    w.date = today;
    w.done = 0;
  }
}

function startWalk(){
  if(state.walk.running) return;
  state.walk.running = true;
  $('walkBtn').textContent = 'KÃ¤vely kÃ¤ynnissÃ¤...';
  $('walkBtn').disabled = true;
  
  const timer = setInterval(()=>{
    state.walk.done++;
    updateWalkUI();
    if(state.walk.done >= state.walk.goal * 60){
      clearInterval(timer);
      state.walk.running = false;
      toast('ğŸ‰ Tavoite tÃ¤ytetty! Pelit aukeavat.');
      setTab('spider');
    }
  }, 1000);
}

function canPlay(){
  return CONFIG.skipWalk || (state.walk.done >= state.walk.goal * 60);
}

// ==================== VÃ„LILEHDET ====================
function setTab(tab){
  if(tab !== 'walk' && !canPlay()){
    toast('KÃ¤vele ensin ' + state.walk.goal + ' min!');
    return;
  }
  
  state.tab = tab;
  document.querySelectorAll('.nav .btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  
  $('walkPanel').style.display = tab==='walk' ? 'block' : 'none';
  $('gamePanel').style.display = tab==='walk' ? 'none' : 'block';
  
  if(tab !== 'walk'){
    state.game = tab;
    if(!state.data) newGame();
    else render();
  }
}

// ==================== PELIALUSTUS ====================
function newGame(){
  state.seed = Date.now();
  state.history = [];
  initGame(state.game);
  render();
}

function restartGame(){
  state.history = [];
  initGame(state.game);
  render();
}

function initGame(mode){
  const rng = rand(state.seed);
  state.selected = null;
  
  if(mode === 'spider'){
    // Spider: 104 korttia, 8 maata (2 pakkaa), 10 saraketta
    let deck = [];
    for(let d=0; d<8; d++){
      for(let r=1; r<=13; r++) deck.push(formatCard(r, 'â™ '));
    }
    // Sekoita
    for(let i=deck.length-1; i>0; i--){
      const j = Math.floor(rng() * (i+1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    
    // Jaa: 4 saraketta 6 korttia, 6 saraketta 5 korttia = 54
    const cols = [];
    for(let c=0; c<10; c++){
      const count = c < 4 ? 6 : 5;
      const col = deck.splice(0, count);
      // Viimeinen kortti ylÃ¶s
      col.forEach((card,i)=>card.up = (i === col.length-1));
      cols.push(col);
    }
    
    state.data = {
      mode: 'spider',
      cols: cols,
      stock: deck,  // 50 jÃ¤ljellÃ¤
      completed: 0
    };
    
  }else if(mode === 'scorpion'){
    // Scorpion: 52 korttia, 4 maata, 7 saraketta
    let deck = [];
    ['â™ ','â™¥','â™¦','â™£'].forEach(s=>{
      for(let r=1; r<=13; r++) deck.push(formatCard(r, s));
    });
    for(let i=deck.length-1; i>0; i--){
      const j = Math.floor(rng() * (i+1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    
    const cols = [];
    for(let c=0; c<7; c++){
      const col = deck.splice(0, 7);
      // 4 ensimmÃ¤istÃ¤ saraketta: 3 korttia alas
      if(c < 4){
        col[0].up = false;
        col[1].up = false;
        col[2].up = false;
        col[3].up = true;
        col[4].up = true;
        col[5].up = true;
        col[6].up = true;
      }else{
        col.forEach(card=>card.up = true);
      }
      cols.push(col);
    }
    
    state.data = {
      mode: 'scorpion',
      cols: cols,
      stock: deck  // 3 jÃ¤ljellÃ¤
    };
    
  }else if(mode === 'golf'){
    // Golf: 52 korttia, 7 saraketta x 5 = 35 pÃ¶ydÃ¤ssÃ¤
    let deck = [];
    ['â™ ','â™¥','â™¦','â™£'].forEach(s=>{
      for(let r=1; r<=13; r++) deck.push(formatCard(r, s));
    });
    for(let i=deck.length-1; i>0; i--){
      const j = Math.floor(rng() * (i+1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
    
    const cols = [];
    for(let c=0; c<7; c++){
      const col = deck.splice(0, 5);
      col.forEach(card=>card.up = true);
      cols.push(col);
    }
    
    state.data = {
      mode: 'golf',
      cols: cols,
      waste: [deck.pop()],  // JÃ¤te alkaa yhdellÃ¤
      stock: deck
    };
  }
}

// ==================== SIIRROT ====================
function canMoveSpider(fromCol, fromIdx, toCol){
  const data = state.data;
  const from = data.cols[fromCol];
  const to = data.cols[toCol];
  
  // Valittu sarja
  const moving = from.slice(fromIdx);
  
  // Tarkista ettÃ¤ sarja on laskeva ja saman maan
  for(let i=0; i<moving.length-1; i++){
    if(moving[i].r !== moving[i+1].r + 1) return false;
  }
  
  // Kohde
  if(to.length === 0) return CONFIG.spiderAllowEmpty;
  
  const target = to[to.length-1];
  if(!target.up) return false;
  
  // Kohde oltava yhtÃ¤ suurempi
  return target.r === moving[0].r + 1;
}

function canMoveScorpion(fromCol, fromIdx, toCol){
  const data = state.data;
  const from = data.cols[fromCol];
  const to = data.cols[toCol];
  const moving = from.slice(fromIdx);
  
  // Vain ylÃ¤puolella olevat face-up kortit
  if(!moving[0].up) return false;
  
  if(to.length === 0) return true;
  
  const target = to[to.length-1];
  // Sama maa, yksi isompi
  return target.s === moving[0].s && target.r === moving[0].r + 1;
}

function canMoveGolf(colIdx){
  const data = state.data;
  const col = data.cols[colIdx];
  if(col.length === 0) return false;
  
  const card = col[col.length-1];
  const wasteTop = data.waste[data.waste.length-1];
  
  // Â±1, A-K wrap
  const diff = Math.abs(card.r - wasteTop.r);
  return diff === 1 || (card.r === 1 && wasteTop.r === 13) || (card.r === 13 && wasteTop.r === 1);
}

function doMove(fromCol, fromIdx, toCol){
  // Tallenna historia
  state.history.push(JSON.parse(JSON.stringify(state.data)));
  if(state.history.length > 20) state.history.shift();
  
  const data = state.data;
  const from = data.cols[fromCol];
  const moving = from.splice(fromIdx);
  
  // KÃ¤Ã¤nnÃ¤ uusi pÃ¤Ã¤llimmÃ¤inen jos tarvitsee
  if(from.length > 0 && !from[from.length-1].up){
    from[from.length-1].up = true;
  }
  
  // LisÃ¤Ã¤ kohteeseen
  data.cols[toCol].push(...moving);
  
  // Spider: tarkista valmis sarja (K-A)
  if(data.mode === 'spider'){
    checkSpiderComplete(toCol);
  }
  
  state.selected = null;
  render();
}

function checkSpiderComplete(colIdx){
  const col = state.data.cols[colIdx];
  if(col.length < 13) return;
  
  // Tarkista viimeiset 13 (K=13, Q=12, ..., A=1)
  const seq = col.slice(-13);
  let complete = true;
  for(let i=0; i<13; i++){
    if(!seq[i].up || seq[i].r !== 13-i){
      complete = false;
      break;
    }
  }
  
  if(complete){
    col.splice(-13);
    state.data.completed++;
    toast('ğŸ Koko sarja valmis!');
    if(col.length > 0) col[col.length-1].up = true;
  }
}

function doGolfMove(colIdx){
  state.history.push(JSON.parse(JSON.stringify(state.data)));
  
  const data = state.data;
  const card = data.cols[colIdx].pop();
  data.waste.push(card);
  
  render();
  
  // Tarkista voitto
  if(data.cols.every(c=>c.length===0)){
    setTimeout(()=>toast('ğŸ‰ Golf lÃ¤pÃ¤isty!'), 100);
  }
}

// ==================== DEAL (Jakaminen) ====================
function deal(){
  const data = state.data;
  state.history.push(JSON.parse(JSON.stringify(data)));
  
  if(data.mode === 'spider' && data.stock.length >= 10){
    for(let c=0; c<10; c++){
      const card = data.stock.pop();
      card.up = true;
      data.cols[c].push(card);
    }
    render();
  }else if(data.mode === 'scorpion' && data.stock.length >= 3){
    for(let c=0; c<3; c++){
      const card = data.stock.pop();
      card.up = true;
      data.cols[c].push(card);
    }
    render();
  }else if(data.mode === 'golf' && data.stock.length > 0){
    const card = data.stock.pop();
    card.up = true;
    data.waste.push(card);
    render();
  }else{
    toast('Ei kortteja jÃ¤ljellÃ¤');
  }
}

function undo(){
  if(state.history.length === 0){
    toast('Ei peruttavaa');
    return;
  }
  state.data = state.history.pop();
  state.selected = null;
  render();
}

// ==================== RENDERÃ–INTI ====================
function render(){
  const data = state.data;
  if(!data) return;
  
  // Info
  let info = `Siirrot: ${state.history.length} | `;
  if(data.mode === 'spider'){
    info += `Valmiit: ${data.completed}/8 | Stock: ${data.stock.length}`;
  }else if(data.mode === 'scorpion'){
    info += `Stock: ${data.stock.length}`;
  }else if(data.mode === 'golf'){
    const top = data.waste[data.waste.length-1];
    info += `JÃ¤te: ${top.rank}${top.suit} | Stock: ${data.stock.length}`;
  }
  $('gameInfo').textContent = info;
  
  // Taulu
  const table = $('table');
  table.className = 'table ' + data.mode;
  table.innerHTML = '';
  
  const colCount = data.mode==='spider' ? 10 : 7;
  
  for(let c=0; c<colCount; c++){
    const colDiv = document.createElement('div');
    colDiv.className = 'col';
    
    // Otsikko
    const header = document.createElement('div');
    header.className = 'col-header';
    header.textContent = c+1;
    colDiv.appendChild(header);
    
    const col = data.cols[c];
    
    // Kortit
    col.forEach((card, idx)=>{
      const cardEl = document.createElement('div');
      cardEl.className = 'card ' + (card.up?'up':'down');
      
      // Valinta
      if(state.selected && state.selected.col===c && idx>=state.selected.idx){
        cardEl.classList.add('selected');
      }
      
      // Sijainti: piilokortit tiiviimmin
      let top = 25; // headerin alta
      for(let i=0; i<idx; i++){
        top += col[i].up ? 16 : 3;
      }
      cardEl.style.top = top + 'px';
      
      // SisÃ¤ltÃ¶
      if(card.up){
        cardEl.innerHTML = `
          <span class="${card.red?'suit-red':'suit-black'}">${card.rank}</span>
          <span class="${card.red?'suit-red':'suit-black'}" style="align-self:flex-end;">${card.suit}</span>
        `;
        
        // Klikkaus
        cardEl.onclick = (e)=>{
          e.stopPropagation();
          handleCardClick(c, idx, card);
        };
      }
      
      colDiv.appendChild(cardEl);
    });
    
    // Sarakkeen klikkaus = kohde
    colDiv.onclick = ()=>{
      if(state.selected && state.selected.col !== c){
        attemptMove(c);
      }
    };
    
    // Alatunniste (isoin nÃ¤kyvÃ¤ kortti)
    const footer = document.createElement('div');
    footer.className = 'col-footer';
    const topCard = col.filter(x=>x.up).pop();
    if(topCard) footer.textContent = topCard.rank;
    colDiv.appendChild(footer);
    
    table.appendChild(colDiv);
  }
}

function handleCardClick(colIdx, cardIdx, card){
  const data = state.data;
  
  // Golf: erillinen logiikka
  if(data.mode === 'golf'){
    if(canMoveGolf(colIdx)){
      doGolfMove(colIdx);
    }else{
      toast('Ei sopiva (pitÃ¤Ã¤ olla Â±1 jÃ¤tteestÃ¤)');
    }
    return;
  }
  
  // Jos jo valittu sama kortti, poista valinta
  if(state.selected && state.selected.col===colIdx && state.selected.idx===cardIdx){
    state.selected = null;
    render();
    return;
  }
  
  // Tarkista voiko valita
  if(data.mode === 'spider'){
    // Tarkista ettÃ¤ valittava sarja on validi (laskeva)
    const col = data.cols[colIdx];
    let valid = true;
    for(let i=cardIdx; i<col.length-1; i++){
      if(col[i].r !== col[i+1].r + 1) valid = false;
    }
    if(!valid){
      toast('Valitse laskeva sarja (Kâ†’Qâ†’J...)');
      return;
    }
    state.selected = {col: colIdx, idx: cardIdx};
    render();
    
  }else if(data.mode === 'scorpion'){
    // Vain face-up kortit
    if(!card.up){
      toast('Kortti on piilossa');
      return;
    }
    state.selected = {col: colIdx, idx: cardIdx};
    render();
  }
}

function attemptMove(toCol){
  const data = state.data;
  const sel = state.selected;
  
  let canMove = false;
  if(data.mode === 'spider'){
    canMove = canMoveSpider(sel.col, sel.idx, toCol);
  }else if(data.mode === 'scorpion'){
    canMove = canMoveScorpion(sel.col, sel.idx, toCol);
  }
  
  if(canMove){
    doMove(sel.col, sel.idx, toCol);
  }else{
    toast('Ei voi siirtÃ¤Ã¤ tuohon');
    state.selected = null;
    render();
  }
}

// ==================== ALUSTUS ====================
updateWalkUI();

// Jos skipWalk pÃ¤Ã¤llÃ¤, avaa suoraan spider
if(CONFIG.skipWalk){
  setTimeout(()=>{
    document.querySelector('[onclick="setTab(\'spider\')"]').click();
  }, 100);
}
</script>
</body>
</html>
