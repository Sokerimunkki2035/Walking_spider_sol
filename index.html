<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Solitaire</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, sans-serif;
      background: linear-gradient(180deg, #0d4a3a, #062921);
      color: #e8f5f2;
      padding: 10px;
      min-height: 100vh;
    }
    
    /* AdSense - vaihda omat tunnukset */
    .ad {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      margin: 8px 0;
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      opacity: 0.6;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.2);
      padding: 10px 15px;
      border-radius: 20px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .nav {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 10px 16px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: inherit;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }
    
    button:hover { background: rgba(255,255,255,0.2); }
    button.active { background: rgba(100,255,150,0.3); }
    button:disabled { opacity: 0.4; cursor: not-allowed; }
    
    .panel {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 10px;
    }
    
    /* P√∂yd√§n asetukset */
    .table {
      display: grid;
      gap: 6px;
      margin-top: 10px;
    }
    
    .table.spider { grid-template-columns: repeat(10, 1fr); }
    .table.scorpion, .table.golf { grid-template-columns: repeat(7, 1fr); }
    
    @media (max-width: 800px) {
      .table.spider { grid-template-columns: repeat(5, 1fr); }
      .table.scorpion, .table.golf { grid-template-columns: repeat(4, 1fr); }
    }
    
    .column {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 5px;
      min-height: 300px;
      position: relative;
    }
    
    .col-number {
      text-align: center;
      font-size: 12px;
      font-weight: 700;
      margin-bottom: 5px;
      opacity: 0.7;
    }
    
    /* Korttien tyyli */
    .card {
      width: 100%;
      aspect-ratio: 3/4;
      background: #f0f4f3;
      color: #1a1a1a;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 4px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      margin-bottom: -35px; /* P√§√§llekk√§isyys */
      position: relative;
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .card:last-child { margin-bottom: 0; }
    
    .card.down {
      background: linear-gradient(135deg, #1e6b5a, #0d3d32);
      color: transparent;
    }
    
    .card.selected {
      outline: 3px solid #ffd700;
      box-shadow: 0 0 10px rgba(255,215,0,0.5);
      z-index: 10;
    }
    
    .red { color: #c41e3a; }
    
    .bottom-card {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      font-weight: 900;
      opacity: 0.3;
      pointer-events: none;
    }
    
    #info {
      margin: 10px 0;
      padding: 10px;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      font-size: 14px;
    }
    
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      padding: 12px 24px;
      border-radius: 25px;
      display: none;
      z-index: 1000;
      font-weight: 600;
    }
  </style>
</head>
<body>

<!-- AdSense ylh√§√§ll√§ -->
<div class="ad">Mainos (ca-pub-XXXXXXXXXX)</div>

<div class="header">
  <div>üÉè Solitaire</div>
  <div>
    üî• <b id="streak">0</b> | 
    üéØ <b id="goal">3</b>min | 
    ‚úÖ <b id="done">0</b>min
  </div>
</div>

<div class="nav">
  <button id="btn-walk" class="active" onclick="switchTab('walk')">üèÉ K√§vely</button>
  <button id="btn-spider" onclick="switchTab('spider')">üï∑Ô∏è Spider</button>
  <button id="btn-scorpion" onclick="switchTab('scorpion')">ü¶Ç Scorpion</button>
  <button id="btn-golf" onclick="switchTab('golf')">‚õ≥ Golf</button>
</div>

<!-- K√§velypaneeli -->
<div id="walk-panel" class="panel">
  <h3>P√§iv√§n k√§velyvelvoite</h3>
  <p style="margin:10px 0; opacity:0.9;">
    Valitse tavoite. Kun t√§yt√§t sen, pelit aukeavat.
  </p>
  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <button onclick="setGoal(3)">3 min</button>
    <button onclick="setGoal(5)">5 min</button>
    <button onclick="setGoal(7)">7 min</button>
  </div>
  <p style="margin-top:15px;">
    Tavoite: <b id="walk-goal">3</b> min | 
    T√§n√§√§n: <b id="walk-done">0</b> min
  </p>
  <label style="display:block; margin-top:10px;">
    <input type="checkbox" id="skip-walk" checked onchange="toggleSkip()"> 
    Ohita k√§vely (testaus)
  </label>
</div>

<!-- Pelipaneeli -->
<div id="game-panel" class="panel" style="display:none;">
  <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
    <button onclick="newGame()">üîÑ Uusi peli</button>
    <button onclick="restartGame()">‚Ü©Ô∏è Aloita alusta</button>
    <button onclick="undo()">‚Ü∂ Peruuta</button>
    <button onclick="dealCards()">üì• Jaa kortteja</button>
  </div>
  
  <div id="info">Ladataan...</div>
  
  <!-- AdSense peliss√§ -->
  <div class="ad" style="min-height:100px;">Mainos</div>
  
  <div id="table" class="table"></div>
</div>

<!-- AdSense alhaalla -->
<div class="ad" style="min-height:250px;">Mainos</div>

<div id="toast"></div>

<script>
// ==================== ASETUKSET ====================
const CONFIG = {
  skipWalk: true  // T√ÑRKE√Ñ: true = ei tarvitse k√§vell√§, false = vaatii k√§velyn
};

// ==================== TILA ====================
let state = {
  tab: 'walk',
  walk: { goal: 3, done: 0 },
  game: null,        // 'spider', 'scorpion', 'golf'
  data: null,        // pelin data
  selected: null,    // {col, startIdx}
  history: []
};

// ==================== APUFUNKTIOT ====================
function $(id) { return document.getElementById(id); }
function toast(msg) {
  const t = $('toast');
  t.textContent = msg;
  t.style.display = 'block';
  setTimeout(() => t.style.display = 'none', 2000);
}

// Satunnaisluku
function mulberry32(a) {
  return function() {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}

// ==================== K√ÑVELY ====================
function setGoal(min) {
  state.walk.goal = min;
  $('goal').textContent = min;
  $('walk-goal').textContent = min;
  toast('Tavoite: ' + min + ' min');
}

function toggleSkip() {
  CONFIG.skipWalk = $('skip-walk').checked;
  toast(CONFIG.skipWalk ? 'K√§vely ohitettu' : 'K√§vely vaaditaan');
}

function canPlay() {
  return CONFIG.skipWalk || state.walk.done >= state.walk.goal * 60;
}

// ==================== V√ÑLILEHDET ====================
function switchTab(tab) {
  if (tab !== 'walk' && !canPlay()) {
    toast('Suorita k√§vely ensin!');
    return;
  }
  
  // P√§ivit√§ napit
  document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
  $('btn-' + tab).classList.add('active');
  
  // N√§yt√§/piilota paneelit
  $('walk-panel').style.display = tab === 'walk' ? 'block' : 'none';
  $('game-panel').style.display = tab === 'walk' ? 'none' : 'block';
  
  state.tab = tab;
  
  if (tab !== 'walk') {
    state.game = tab;
    if (!state.data || state.data.mode !== tab) {
      newGame();
    } else {
      render();
    }
  }
}

// ==================== PELIALUSTUS ====================
function newGame() {
  state.history = [];
  state.selected = null;
  
  const seed = Date.now();
  const rng = mulberry32(seed);
  
  if (state.game === 'spider') initSpider(rng);
  else if (state.game === 'scorpion') initScorpion(rng);
  else if (state.game === 'golf') initGolf(rng);
  
  render();
}

function restartGame() {
  // Palauta historiasta ensimm√§inen tila tai alusta
  state.history = [];
  state.selected = null;
  newGame();
}

function initSpider(rng) {
  // 104 korttia (8 x 13), kaikki pataa
  let deck = [];
  for (let i = 0; i < 8; i++) {
    for (let r = 1; r <= 13; r++) {
      deck.push({ r: r, s: '‚ô†', up: false });
    }
  }
  
  // Sekoita
  for (let i = deck.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
  
  // Jaa 10 sarakkeeseen: 4x6 + 6x5 = 54
  const cols = [];
  for (let c = 0; c < 10; c++) {
    const count = c < 4 ? 6 : 5;
    const col = deck.splice(0, count);
    col[col.length - 1].up = true; // Viimeinen yl√∂s
    cols.push(col);
  }
  
  state.data = {
    mode: 'spider',
    cols: cols,
    stock: deck,
    completed: 0,
    moves: 0
  };
}

function initScorpion(rng) {
  // 52 korttia, 4 maata
  let deck = [];
  const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
  for (let s of suits) {
    for (let r = 1; r <= 13; r++) {
      deck.push({ r: r, s: s, up: true });
    }
  }
  
  for (let i = deck.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
  
  const cols = [];
  for (let c = 0; c < 7; c++) {
    const col = deck.splice(0, 7);
    // 4 ensimm√§ist√§ saraketta: 3 alinta alas
    if (c < 4) {
      col[0].up = false;
      col[1].up = false;
      col[2].up = false;
    }
    cols.push(col);
  }
  
  state.data = {
    mode: 'scorpion',
    cols: cols,
    stock: deck,
    moves: 0
  };
}

function initGolf(rng) {
  let deck = [];
  const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
  for (let s of suits) {
    for (let r = 1; r <= 13; r++) {
      deck.push({ r: r, s: s, up: true });
    }
  }
  
  for (let i = deck.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
  
  const cols = [];
  for (let c = 0; c < 7; c++) {
    cols.push(deck.splice(0, 5));
  }
  
  state.data = {
    mode: 'golf',
    cols: cols,
    waste: [deck.pop()],
    stock: deck,
    moves: 0
  };
}

// ==================== PELIMEKANIikat ====================
function getRankName(r) {
  if (r === 1) return 'A';
  if (r === 11) return 'J';
  if (r === 12) return 'Q';
  if (r === 13) return 'K';
  return String(r);
}

function isRed(s) {
  return s === '‚ô•' || s === '‚ô¶';
}

// Tarkista voiko siirt√§√§ Spiderissa
function canSpiderMove(fromCol, fromIdx, toCol) {
  const data = state.data;
  const from = data.cols[fromCol];
  const to = data.cols[toCol];
  
  // Sarjan oltava laskeva (K-Q-J...)
  for (let i = fromIdx; i < from.length - 1; i++) {
    if (from[i].r !== from[i + 1].r + 1) return false;
  }
  
  // Kohde
  if (to.length === 0) return true; // Tyhj√§√§n saa
  
  const target = to[to.length - 1];
  if (!target.up) return false;
  
  // Kohde oltava yht√§ suurempi
  return target.r === from[fromIdx].r + 1;
}

// Tarkista voiko siirt√§√§ Scorpionissa
function canScorpionMove(fromCol, fromIdx, toCol) {
  const data = state.data;
  const from = data.cols[fromCol];
  const to = data.cols[toCol];
  
  if (!from[fromIdx].up) return false;
  
  if (to.length === 0) return true;
  
  const target = to[to.length - 1];
  // Sama maa, yksi isompi
  return target.s === from[fromIdx].s && target.r === from[fromIdx].r + 1;
}

// Tee siirto
function doMove(fromCol, fromIdx, toCol) {
  // Tallenna historia
  state.history.push(JSON.parse(JSON.stringify(state.data)));
  if (state.history.length > 50) state.history.shift();
  
  const data = state.data;
  const moving = data.cols[fromCol].splice(fromIdx);
  
  // K√§√§nn√§ uusi p√§√§llimm√§inen
  const from = data.cols[fromCol];
  if (from.length > 0 && !from[from.length - 1].up) {
    from[from.length - 1].up = true;
  }
  
  // Lis√§√§ kohteeseen
  data.cols[toCol].push(...moving);
  data.moves++;
  
  // Spider: tarkista valmis sarja
  if (data.mode === 'spider') {
    checkSpiderCompletion(toCol);
  }
  
  state.selected = null;
  render();
}

function checkSpiderCompletion(colIdx) {
  const col = state.data.cols[colIdx];
  if (col.length < 13) return;
  
  // Tarkista viimeiset 13 (K-A)
  const seq = col.slice(-13);
  let ok = true;
  for (let i = 0; i < 13; i++) {
    if (!seq[i].up || seq[i].r !== 13 - i) {
      ok = false;
      break;
    }
  }
  
  if (ok) {
    col.splice(-13);
    state.data.completed++;
    toast('üèÅ Koko sarja valmis!');
    if (col.length > 0) col[col.length - 1].up = true;
  }
}

// Golf-siirto
function doGolfMove(colIdx) {
  const data = state.data;
  const card = data.cols[colIdx][data.cols[colIdx].length - 1];
  const wasteTop = data.waste[data.waste.length - 1];
  
  // Tarkista ¬±1 (A-K wrap)
  let diff = Math.abs(card.r - wasteTop.r);
  const valid = diff === 1 || (card.r === 1 && wasteTop.r === 13) || (card.r === 13 && wasteTop.r === 1);
  
  if (!valid) {
    toast('Ei sopiva (¬±1 j√§tteest√§)');
    return;
  }
  
  state.history.push(JSON.parse(JSON.stringify(data)));
  data.waste.push(data.cols[colIdx].pop());
  data.moves++;
  
  render();
  
  // Voitto?
  if (data.cols.every(c => c.length === 0)) {
    setTimeout(() => toast('üéâ Voitit!'), 100);
  }
}

// Jaa kortteja stockista
function dealCards() {
  const data = state.data;
  
  if (data.mode === 'spider' && data.stock.length >= 10) {
    state.history.push(JSON.parse(JSON.stringify(data)));
    for (let c = 0; c < 10; c++) {
      const card = data.stock.pop();
      card.up = true;
      data.cols[c].push(card);
    }
    data.moves++;
    render();
    
  } else if (data.mode === 'scorpion' && data.stock.length >= 3) {
    state.history.push(JSON.parse(JSON.stringify(data)));
    for (let c = 0; c < 3; c++) {
      const card = data.stock.pop();
      card.up = true;
      data.cols[c].push(card);
    }
    data.moves++;
    render();
    
  } else if (data.mode === 'golf' && data.stock.length > 0) {
    state.history.push(JSON.parse(JSON.stringify(data)));
    const card = data.stock.pop();
    card.up = true;
    data.waste.push(card);
    data.moves++;
    render();
    
  } else {
    toast('Ei kortteja j√§ljell√§');
  }
}

// Peruuta
function undo() {
  if (state.history.length === 0) {
    toast('Ei peruttavaa');
    return;
  }
  state.data = state.history.pop();
  state.selected = null;
  render();
}

// ==================== K√ÑYTT√ñLIITTYM√Ñ ====================
function render() {
  const data = state.data;
  if (!data) return;
  
  // Info
  let info = '';
  if (data.mode === 'spider') {
    info = `Siirrot: ${data.moves} | Valmiit: ${data.completed}/8 | Stock: ${data.stock.length}`;
  } else if (data.mode === 'scorpion') {
    info = `Siirrot: ${data.moves} | Stock: ${data.stock.length}`;
  } else if (data.mode === 'golf') {
    const top = data.waste[data.waste.length - 1];
    info = `Siirrot: ${data.moves} | J√§te: ${getRankName(top.r)}${top.s} | Stock: ${data.stock.length}`;
  }
  $('info').textContent = info;
  
  // P√∂yt√§
  const table = $('table');
  table.className = 'table ' + data.mode;
  table.innerHTML = '';
  
  const colCount = data.mode === 'spider' ? 10 : 7;
  
  for (let c = 0; c < colCount; c++) {
    const colDiv = document.createElement('div');
    colDiv.className = 'column';
    
    // Sarakenumero
    const num = document.createElement('div');
    num.className = 'col-number';
    num.textContent = c + 1;
    colDiv.appendChild(num);
    
    const col = data.cols[c];
    
    // Kortit
    col.forEach((card, idx) => {
      const cardEl = document.createElement('div');
      cardEl.className = 'card ' + (card.up ? 'up' : 'down');
      
      // Valinta
      if (state.selected && state.selected.col === c && idx >= state.selected.idx) {
        cardEl.classList.add('selected');
      }
      
      if (card.up) {
        cardEl.innerHTML = `
          <span class="${isRed(card.s) ? 'red' : ''}">${getRankName(card.r)}</span>
          <span class="${isRed(card.s) ? 'red' : ''}" style="align-self:flex-end;">${card.s}</span>
        `;
        
        // Klikkaus
        cardEl.onclick = (e) => {
          e.stopPropagation();
          handleCardClick(c, idx);
        };
      }
      
      colDiv.appendChild(cardEl);
    });
    
    // Sarakkeen klikkaus = kohde
    colDiv.onclick = () => {
      if (state.selected !== null && state.selected.col !== c) {
        attemptMove(c);
      }
    };
    
    // Alin kortti n√§kyviin
    const bottomCard = col.filter(x => x.up).pop();
    if (bottomCard) {
      const b = document.createElement('div');
      b.className = 'bottom-card';
      b.textContent = getRankName(bottomCard.r);
      colDiv.appendChild(b);
    }
    
    table.appendChild(colDiv);
  }
}

function handleCardClick(col, idx) {
  const data = state.data;
  
  // Golf: eri logiikka
  if (data.mode === 'golf') {
    if (idx === data.cols[col].length - 1) {
      doGolfMove(col);
    }
    return;
  }
  
  // Jos valittu jo t√§m√§, poista valinta
  if (state.selected && state.selected.col === col && state.selected.idx === idx) {
    state.selected = null;
    render();
    return;
  }
  
  // Tarkista ett√§ kortti on yl√∂s
  if (!data.cols[col][idx].up) {
    toast('Kortti on piilossa');
    return;
  }
  
  // Spider: tarkista laskeva sarja
  if (data.mode === 'spider') {
    for (let i = idx; i < data.cols[col].length - 1; i++) {
      if (data.cols[col][i].r !== data.cols[col][i + 1].r + 1) {
        toast('Valitse laskeva sarja (K‚ÜíQ‚ÜíJ...)');
        return;
      }
    }
  }
  
  // Valitse
  state.selected = { col: col, idx: idx };
  render();
}

function attemptMove(toCol) {
  const data = state.data;
  const sel = state.selected;
  
  let canMove = false;
  if (data.mode === 'spider') {
    canMove = canSpiderMove(sel.col, sel.idx, toCol);
  } else if (data.mode === 'scorpion') {
    canMove = canScorpionMove(sel.col, sel.idx, toCol);
  }
  
  if (canMove) {
    doMove(sel.col, sel.idx, toCol);
  } else {
    toast('Ei voi siirt√§√§ tuohon');
    state.selected = null;
    render();
  }
}

// ==================== ALUSTUS ====================
$('skip-walk').checked = CONFIG.skipWalk;
setGoal(3);

// Jos skip p√§√§ll√§, avaa spider automaattisesti
if (CONFIG.skipWalk) {
  setTimeout(() => switchTab('spider'), 100);
}
</script>
</body>
</html>
