<!DOCTYPE html>
<html lang="fi">
<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-N8Z8Z9M6');</script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walking Scorpio</title>
    <style>
        :root { --bg: #072b22; --accent: #1e6b54; --text-light: #78ffc8; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; padding: 10px; margin: 0; user-select: none; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .pill { background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 15px; font-size: 13px; border: 1px solid rgba(255,255,255,0.1); }
        .controls { margin-bottom: 15px; display: flex; gap: 8px; }
        button { padding: 8px 12px; cursor: pointer; background: var(--accent); color: white; border: none; border-radius: 6px; font-weight: bold; }
        #table { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; max-width: 900px; margin: 0 auto; }
        .column { background: rgba(255,255,255,0.03); min-height: 60vh; position: relative; border-radius: 4px; }
        .card { background: white; border: 1px solid #222; border-radius: 4px; padding: 3px; margin-bottom: -35px; aspect-ratio: 1/1.4; color: black; font-weight: bold; position: relative; cursor: pointer; font-size: 14px; }
        .card.face-down { background: #134537; color: transparent; }
        .card.selected { outline: 3px solid #ffeb3b; z-index: 10; transform: translateY(-3px); }
        .suit-red { color: #d32f2f; }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N8Z8Z9M6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div class="header">
        <h3 style="margin:0; color:var(--text-light);">ðŸ¦‚ Scorpio</h3>
        <div class="pill">Siirrot: <span id="moveCount">0</span></div>
    </div>
    <div class="controls">
        <button onclick="newGame()">Uusi</button>
        <button onclick="undo()">Peru</button>
    </div>
    <div id="table"></div>

    <script>
        let columns = [[],[],[],[],[],[],[]], deck = [], history = [], moves = 0;
        let selCol = -1, selIdx = -1;

        function newGame() {
            deck = []; moves = 0; history = [];
            const suits = ['â™ ', 'â™£', 'â™¥', 'â™¦'];
            for(let s of suits) for(let r=1; r<=13; r++) deck.push({r, s, f: false});
            deck.sort(() => Math.random() - 0.5);
            columns = [[],[],[],[],[],[],[]];
            for(let i=0; i<49; i++) {
                let c = i % 7;
                let card = deck.pop();
                card.f = !(c < 3 && columns[c].length < 3);
                columns[c].push(card);
            }
            update();
        }

        function update() {
            const table = document.getElementById("table");
            table.innerHTML = "";
            columns.forEach((col, ci) => {
                let colDiv = document.createElement("div");
                colDiv.className = "column";
                colDiv.onclick = () => move(ci);
                col.forEach((card, ri) => {
                    let div = document.createElement("div");
                    div.className = "card" + (!card.f ? " face-down" : "");
                    if(card.s === 'â™¥' || card.s === 'â™¦') div.classList.add("suit-red");
                    if(ci === selCol && ri >= selIdx) div.classList.add("selected");
                    if(card.f) {
                        div.innerHTML = (card.r===1?'A':card.r===11?'J':card.r===12?'Q':card.r===13?'K':card.r)+card.s;
                        div.onclick = (e) => { e.stopPropagation(); selCol=ci; selIdx=ri; update(); };
                    }
                    colDiv.appendChild(div);
                });
                table.appendChild(colDiv);
            });
            document.getElementById("moveCount").innerText = moves;
        }

        function move(ti) {
            if(selCol === -1 || selCol === ti) return;
            let can = false, count = true;
            const cards = columns[selCol].slice(selIdx);
            const target = columns[ti];
            if(target.length === 0) {
                if(cards[0].r === 13) {
                    can = true;
                    if(selIdx === 0) count = false;
                }
            } else {
                const last = target[target.length-1];
                if(last.r === cards[0].r + 1 && last.s === cards[0].s) can = true;
            }
            if(can) {
                history.push(JSON.parse(JSON.stringify({c: columns, m: moves})));
                if(count) moves++;
                columns[ti].push(...columns[selCol].splice(selIdx));
                if(columns[selCol].length > 0) columns[selCol][columns[selCol].length-1].f = true;
            }
            selCol = -1; update();
        }

        function undo() { if(history.length) { let p = history.pop(); columns=p.c; moves=p.m; update(); } }
        newGame();
    </script>
</body>
</html>
