<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Uusi blogipostaus</title>

  <style>
    :root{--bg:#004d40;--card:#fff;--txt:#10211e;--muted:#5b6f6b;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#fff;}
    .wrap{max-width:760px;margin:0 auto;padding:14px;}
    .card{background:var(--card);color:var(--txt);border-radius:16px;padding:14px;box-shadow:0 8px 22px rgba(0,0,0,.18);margin:12px 0;}
    label{display:block;font-weight:700;margin:10px 0 6px;}
    input,textarea{width:100%;box-sizing:border-box;padding:12px;border-radius:12px;border:1px solid #dbe5e3;font-size:16px;}
    textarea{min-height:180px;resize:vertical;}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > div{flex:1;min-width:200px}
    button{
      width:100%;padding:12px 14px;border-radius:14px;border:0;
      background:#0b5f52;color:#fff;font-size:16px;font-weight:800;
    }
    .btn2{background:#1f8b63;}
    .small{font-size:13px;color:var(--muted);line-height:1.4}
    a{color:#eafff5;text-decoration:none;font-weight:800}
    .top{display:flex;gap:10px;justify-content:space-between;align-items:center}
    pre{white-space:pre-wrap;word-break:break-word;background:#f4f8f7;padding:12px;border-radius:12px;border:1px solid #e6eceb;color:#10211e}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <a href="./index.html">← Blogiin</a>
      <a href="../index.html">Sovellukseen</a>
    </div>

    <div class="card">
      <h1 style="margin:6px 0 0">Uusi blogipostaus</h1>
      <p class="small">Kirjoita tähän. Lopuksi paina <b>Luo postaus</b> ja <b>Lataa .html</b>. Et näe HTML:ää muuten kuin jos haluat.</p>
    </div>

    <div class="card">
      <label>Otsikko</label>
      <input id="title" placeholder="Esim. Miksi tein tämän sivun">

      <div class="row">
        <div>
          <label>Päivä (automaattinen)</label>
          <input id="date" readonly>
        </div>
        <div>
          <label>Tagit (pilkuilla)</label>
          <input id="tags" placeholder="spider, kävely, projekti">
        </div>
      </div>

      <label>Kuvan URL (valinnainen)</label>
      <input id="img" placeholder="https://...jpg">

      <label>Teksti</label>
      <textarea id="body" placeholder="Kirjoita postauksen teksti tähän..."></textarea>

      <div style="height:10px"></div>
      <button id="build">Luo postaus</button>
      <div style="height:10px"></div>
      <button class="btn2" id="download" disabled>Lataa postaus .html</button>

      <p class="small" id="hint" style="margin-top:10px"></p>
    </div>

    <div class="card" id="previewCard" style="display:none">
      <h2 style="margin-top:0">Valmis tiedostonimi</h2>
      <pre id="filename"></pre>
      <h2>Valmis linkki blogiin (kopioi index.html:ään)</h2>
      <pre id="linkline"></pre>
    </div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);

  function todayISO(){
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }

  function slugify(s){
    return (s||"postaus")
      .toLowerCase()
      .trim()
      .replace(/å/g,'a').replace(/ä/g,'a').replace(/ö/g,'o')
      .replace(/[^a-z0-9]+/g,'-')
      .replace(/^-+|-+$/g,'')
      .slice(0,60) || "postaus";
  }

  function escapeHtml(text){
    return (text||"").replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  function buildPostHTML({title,date,tags,img,body}){
    const safeTitle = escapeHtml(title);
    const safeMeta = escapeHtml(`${date} · ${tags}`);
    const bodyHtml = escapeHtml(body).split(/\n\s*\n/).map(p=>`<p>${p.replace(/\n/g,"<br>")}</p>`).join("\n");
    const imgHtml = img ? `<img src="${escapeHtml(img)}" alt="">` : "";

    return `<!doctype html>
<html lang="fi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${safeTitle}</title>

<!-- Google AdSense (pidä sama client kuin sinulla) -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7652525244986434" crossorigin="anonymous"></script>

<style>
:root{--bg:#004d40;--card:#fff;--txt:#10211e;--muted:#5b6f6b;}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#fff;}
.wrap{max-width:720px;margin:0 auto;padding:14px;}
.card{background:var(--card);color:var(--txt);border-radius:16px;padding:16px;box-shadow:0 8px 22px rgba(0,0,0,.18);margin:12px 0;}
a{color:#eafff5;text-decoration:none;font-weight:800}
.btn{display:inline-block;background:#0b5f52;border:1px solid rgba(255,255,255,.25);padding:10px 12px;border-radius:12px;}
.small{font-size:13px;color:var(--muted);line-height:1.5}
img{max-width:100%;border-radius:14px;display:block;margin:12px 0;}
p{line-height:1.65;font-size:16px;}
</style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;gap:10px;justify-content:space-between;align-items:center">
    <a class="btn" href="./index.html">← Blogiin</a>
    <a class="btn" href="../index.html">Sovellukseen</a>
  </div>

  <div class="card">
    <h1 style="margin:6px 0 8px">${safeTitle}</h1>
    <div class="small">${safeMeta}</div>
  </div>

  <div class="card">
    ${imgHtml}
    ${bodyHtml}
  </div>

  <div class="card" style="text-align:center">
    <div class="small"><a href="../privacy.html">Tietosuoja</a></div>
  </div>
</div>
</body>
</html>`;
  }

  $("date").value = todayISO();

  let built = null;
  let outName = null;

  $("build").onclick = ()=>{
    const title = $("title").value.trim();
    const date = $("date").value.trim();
    const tags = $("tags").value.trim();
    const img = $("img").value.trim();
    const body = $("body").value.trim();

    if(!title || !body){
      $("hint").textContent = "Täytä ainakin otsikko ja teksti.";
      return;
    }

    const slug = slugify(title);
    outName = `${date}-${slug}.html`;
    built = buildPostHTML({title,date,tags,img,body});

    $("download").disabled = false;
    $("hint").textContent = "Valmis! Lataa .html ja uploadaa se GitHubiin blog-kansioon.";
    $("previewCard").style.display = "block";
    $("filename").textContent = `blog/${outName}`;
    $("linkline").textContent =
`<a href="${outName}">
  <strong>${title}</strong><br>
  <span class="small">${date}</span>
</a>`;
  };

  $("download").onclick = ()=>{
    if(!built || !outName) return;
    const blob = new Blob([built], {type:"text/html;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = outName;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 2000);
  };
</script>
</body>
</html>
