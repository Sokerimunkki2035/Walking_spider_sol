<!DOCTYPE html>
<html lang="fi">
<head>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-54P5D7QS');</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Walking Spider - 1 maa</title>
  
  <style>
    :root { --card-aspect-ratio: 1.35; --bg: #072b22; --accent: #1e6b54; --text-light: #78ffc8; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; padding: 10px; margin: 0; user-select: none; }
    .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
    .pill { background: rgba(0,0,0,0.5); padding: 6px 12px; border-radius: 20px; font-weight: bold; font-size: 13px; border: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 5px; }
    .controls { margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px; }
    button { padding: 10px 14px; cursor: pointer; background: var(--accent); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-weight: bold; }
    #table { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; max-width: 1000px; margin: 0 auto; }
    .column { background: rgba(255,255,255,0.03); border-radius: 4px; min-height: 70vh; position: relative; padding-bottom: 50px; }
    .card { background: white; border: 1px solid #222; border-radius: 4px; padding: 4px; margin-bottom: -32px; aspect-ratio: 1 / var(--card-aspect-ratio); font-size: 14px; font-weight: bold; cursor: pointer; position: relative; color: black; box-sizing: border-box; }
    .card.face-down { background: #134537; color: transparent; border: 1px solid rgba(255,255,255,0.1); }
    .card.selected { outline: 3px solid #ffeb3b; z-index: 100; transform: translateY(-3px); }
    .suit-spade { color: black; }
  </style>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-54P5D7QS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<div class="header-row">
    <h2 style="margin:0; color:var(--text-light);">üï∑Ô∏è Spider 1 maa</h2>
    <div class="pill">üîÑ Siirrot: <span id="actualMovesUI">0</span></div>
</div>

<div class="controls">
  <button onclick="newGame()">Uusi peli</button>
  <button id="undoBtn" onclick="undoMove()">Peru</button>
</div>

<div id="table"></div>

<script>
let columns = [[],[],[],[],[],[],[],[],[],[]], deck = [], moveHistory = [], actualMovesCount = 0;
let selectedCol = -1, selectedIdx = -1;

function newGame() {
    deck = [];
    actualMovesCount = 0;
    moveHistory = [];
    // 1 maa (Pata): 8 sarjaa √§ss√§st√§ kuninkaaseen
    for(let i=0; i<8; i++) {
        for(let r=1; r<=13; r++) deck.push({rank: r, suit: '‚ô†', faceUp: false});
    }
    deck.sort(() => Math.random() - 0.5);
    
    columns = [[],[],[],[],[],[],[],[],[],[]];
    for(let i=0; i<54; i++) {
        let card = deck.pop();
        let col = i % 10;
        columns[col].push(card);
    }
    columns.forEach(col => { if(col.length > 0) col[col.length-1].faceUp = true; });
    updateUI();
}

function updateUI() {
    const table = document.getElementById("table");
    table.innerHTML = "";
    columns.forEach((col, cIdx) => {
        let colDiv = document.createElement("div");
        colDiv.className = "column";
        colDiv.onclick = () => handleColumnClick(cIdx);
        col.forEach((card, rIdx) => {
            let cardDiv = document.createElement("div");
            cardDiv.className = "card" + (!card.faceUp ? " face-down" : "");
            if(cIdx === selectedCol && rIdx >= selectedIdx) cardDiv.classList.add("selected");
            if(card.faceUp) {
                cardDiv.innerHTML = card.rank === 1 ? 'A‚ô†' : card.rank === 11 ? 'J‚ô†' : card.rank === 12 ? 'Q‚ô†' : card.rank === 13 ? 'K‚ô†' : card.rank + '‚ô†';
                cardDiv.onclick = (e) => { e.stopPropagation(); handleCardClick(cIdx, rIdx); };
            }
            colDiv.appendChild(cardDiv);
        });
        table.appendChild(colDiv);
    });
    document.getElementById("actualMovesUI").innerText = actualMovesCount;
}

function handleCardClick(cIdx, rIdx) {
    if(!columns[cIdx][rIdx].faceUp) return;
    if(selectedCol === cIdx && selectedIdx === rIdx) { selectedCol = -1; selectedIdx = -1; }
    else { selectedCol = cIdx; selectedIdx = rIdx; }
    updateUI();
}

function handleColumnClick(tIdx) {
    if(selectedCol === -1) return;
    let canMove = false;
    let shouldCount = true;
    const movingCards = columns[selectedCol].slice(selectedIdx);
    const firstMoving = movingCards[0];
    
    if(columns[tIdx].length === 0) {
        canMove = true;
        // KUNINGAS-S√Ñ√ÑNT√ñ: Jos kuningas on jo pinon ylin, ei lasketa
        if(firstMoving.rank === 13 && selectedIdx === 0) shouldCount = false;
    } else {
        const lastTarget = columns[tIdx][columns[tIdx].length - 1];
        if(lastTarget.rank === firstMoving.rank + 1) canMove = true;
    }

    if(canMove && selectedCol !== tIdx) {
        moveHistory.push(JSON.parse(JSON.stringify({cols: columns, count: actualMovesCount})));
        if(shouldCount) actualMovesCount++;
        columns[tIdx].push(...columns[selectedCol].splice(selectedIdx));
        if(columns[selectedCol].length > 0) columns[selectedCol][columns[selectedCol].length-1].faceUp = true;
    }
    selectedCol = -1; updateUI();
}

function undoMove() {
    if(moveHistory.length > 0) {
        let prev = moveHistory.pop();
        columns = prev.cols; actualMovesCount = prev.count; updateUI();
    }
}

newGame();
</script>
</body>
</html>
 
