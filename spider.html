<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spider Solitaire</title>

<style>
body{
  margin:0;
  padding:12px;
  background:#0d4a3a;
  color:#fff;
  font-family:system-ui, -apple-system, Segoe UI, sans-serif;
}

.topbar{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
  margin-bottom:10px;
}

button{
  background:#2a8b6f;
  border:none;
  color:#fff;
  padding:8px 12px;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
}
button:hover{ background:#3aa382; }

.pill{
  padding:8px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.15);
  font-weight:700;
}

#zoomWrapper{
  transform-origin: top center;
}

#board{
  display:flex;
  gap:10px;
  overflow-x:auto;
  padding:10px;
}

.column{
  position:relative;
  width:78px;
  min-height:460px;
  background:rgba(255,255,255,0.08);
  border-radius:12px;
  padding-top:22px;
  flex:0 0 auto;
}

.coltitle{
  position:absolute;
  top:4px;
  left:0;
  right:0;
  text-align:center;
  font-size:11px;
  opacity:.8;
  pointer-events:none;
}

.card{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:70px;
  height:100px;
  background:#fff;
  color:#000;
  border-radius:10px;
  border:1px solid #333;
  padding:6px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  box-shadow:0 8px 14px rgba(0,0,0,.35);
  cursor:pointer;
}

.card.selected{
  outline:3px solid gold;
  z-index:1000;
}

.rank{ font-weight:900; font-size:18px; }
.suit{ align-self:flex-end; }

#info{
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  background:rgba(0,0,0,.4);
  font-weight:700;
}
</style>
</head>

<body>

<div class="topbar">
  <button onclick="location.href='index.html'">← Valikkoon</button>
  <button onclick="newGame()">Uusi peli</button>
  <button onclick="undo()">↩ Undo</button>
  <button onclick="zoomOut()">− Zoom</button>
  <div class="pill" id="zoomLabel">100%</div>
  <button onclick="zoomIn()">＋ Zoom</button>
  <div class="pill">Siirrot: <span id="moves">0</span></div>
</div>

<div id="zoomWrapper">
  <div id="board"></div>
</div>

<div id="info">Peli valmis.</div>

<script>
const GAP = 24;
let zoom = 1;

let columns = [];
let selected = null;
let history = [];
let moves = 0;

function buildDeck(){
  const ranks = [1,2,3,4,5,6,7,8,9,10,11,12,13];
  let deck=[];
  for(let i=0;i<8;i++){
    for(let r of ranks){
      deck.push({rank:r});
    }
  }
  return deck.sort(()=>Math.random()-0.5);
}

function newGame(){
  const deck = buildDeck();
  columns = Array.from({length:10},()=>[]);
  for(let c=0;c<10;c++){
    const n = c<4 ? 6 : 5;
    for(let i=0;i<n;i++) columns[c].push(deck.pop());
  }
  history=[];
  moves=0;
  updateMoves();
  selected=null;
  render();
  setInfo("Uusi peli aloitettu.");
}

function render(){
  const board=document.getElementById('board');
  board.innerHTML='';
  columns.forEach((col,ci)=>{
    const colEl=document.createElement('div');
    colEl.className='column';
    colEl.onclick=()=>tryMove(ci);

    const t=document.createElement('div');
    t.className='coltitle';
    t.textContent=`Pino ${ci+1}`;
    colEl.appendChild(t);

    col.forEach((card,i)=>{
      const c=document.createElement('div');
      c.className='card';
      c.style.top=(i*GAP)+'px';
      if(selected && selected.col===ci && selected.idx===i){
        c.classList.add('selected');
      }
      c.onclick=(e)=>{
        e.stopPropagation();
        select(ci,i);
      };
      c.innerHTML=`<div class="rank">${rankName(card.rank)}</div><div class="suit">♠</div>`;
      colEl.appendChild(c);
    });
    board.appendChild(colEl);
  });
}

function select(col,idx){
  if(selected && selected.col===col && selected.idx===idx){
    selected=null;
  }else{
    selected={col,idx};
    setInfo("Valitse kohdepino.");
  }
  render();
}

function tryMove(target){
  if(!selected) return;
  if(selected.col===target){ selected=null; render(); return; }

  const from=columns[selected.col];
  const to=columns[target];
  const card=from[selected.idx];

  if(to.length===0 || to[to.length-1].rank===card.rank+1){
    history.push(JSON.parse(JSON.stringify(columns)));
    to.push(...from.splice(selected.idx));
    moves++;
    updateMoves();
    setInfo("Siirto onnistui.");
  }else{
    setInfo("Laiton siirto.");
  }
  selected=null;
  render();
}

function undo(){
  if(history.length===0){
    setInfo("Ei peruttavaa.");
    return;
  }
  columns=history.pop();
  moves=Math.max(0,moves-1);
  updateMoves();
  render();
  setInfo("Siirto peruttu.");
}

function rankName(r){
  return r===1?'A':r===11?'J':r===12?'Q':r===13?'K':r;
}

function setInfo(t){ document.getElementById('info').textContent=t; }
function updateMoves(){ document.getElementById('moves').textContent=moves; }

function applyZoom(){
  document.getElementById('zoomWrapper').style.transform=`scale(${zoom})`;
  document.getElementById('zoomLabel').textContent=Math.round(zoom*100)+'%';
}
function zoomIn(){ zoom=Math.min(1.2,zoom+0.05); applyZoom(); }
function zoomOut(){ zoom=Math.max(0.6,zoom-0.05); applyZoom(); }

newGame();
applyZoom();
</script>

</body>
</html> 
